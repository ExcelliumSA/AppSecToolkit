name: Assemble Toolkit
# See https://docs.github.com/en/free-pro-team@latest/actions/reference/specifications-for-github-hosted-runners
on:
  workflow_dispatch:
  schedule:
    - cron: "0 8 * * 6"
  push:
    branches:
      - main
jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [windows-latest]
    steps:
      - name: Checkout on ${{ matrix.os }}
        uses: actions/checkout@v3
      - name: Assemble tookit on ${{ matrix.os }}
        run: .\Build-Toolkit.ps1
        shell: powershell
      - name: Verify ZIP archive on ${{ matrix.os }}
        run: 7z t Toolkit.zip
        shell: powershell
      - name: Create hash of archive on ${{ matrix.os }}
        run: Get-FileHash -Algorithm SHA256 .\Toolkit.zip | Format-List | Out-File -FilePath Hash.txt -Encoding "utf8"
        shell: powershell
      - name: Release the ZIP archive on ${{ matrix.os }}
        uses: marvinpinto/action-automatic-releases@latest
        with:
          repo_token: "${{ secrets.GITHUB_TOKEN }}"
          automatic_release_tag: "latest"
          prerelease: false
          title: "Toolkit built from commit ${{ github.sha }}"
          files: |
            Toolkit.zip
            Hash.txt
